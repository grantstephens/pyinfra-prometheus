# # Generated by pyinfra-prometheus
# Global settings
global:
  scrape_interval:     {{ host.data.prometheus_scrape_interval }}
  evaluation_interval: {{ host.data.prometheus_evaluation_interval }}
  # scrape_timeout is set to the global default (10s).

# Store settings
storage:
  local:
    {% if host.data.prometheus_target_heap_size -%}
    target-heap-size: {{ host.data.prometheus_target_heap_size }}
    {% endif %}

# Alertmanager configuration
alerting:
  alertmanagers:
  - static_configs:
    - targets:
      # - alertmanager:9093

# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
rule_files:
  # - "first_rules.yml"
  # - "second_rules.yml"

# A scrape configuration containing exactly one endpoint to scrape:
# Here it's Prometheus itself.
scrape_configs:
  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
{% for job in host.data.prometheus_jobs %}
- job_name: {% for key, value in job.items() %}{{key}}
  {% for key1, value1 in value.items() %}{{key1}}: {% if value1 is string %}{{value1}}{% else %}{% for key2, value2 in value1.items() %}
    - {{key2}}: {% for value3 in value2 %}
      - {{value3}}{% endfor %}{% endfor %}{% endif %}
  {% endfor %}        
{% endfor %}{% endfor %}

